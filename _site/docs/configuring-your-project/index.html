<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Configuring Your Job</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="ClusterRunner">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
</head>


<body class="wrap">
  <header>
  <div class="os-banner hide-on-mobiles">
    <div class="grid one-third">
        <a href="http://opensource.box.com/"><img src="http://opensource.box.com/assets/images/logo.png"></a>
    </div>
  </div>

  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="current">
    <a href="/docs/home/">Doc<span class="show-on-mobiles">s</span><span class="hide-on-mobiles">umentation</span></a>
  </li>
  <li class="">
    <a href="/news/">Blog</a>
  </li>
  <li>
    <a href="https://github.com/box/ClusterRunner"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <div class="unit one-third center-on-mobiles" style="padding:25px 0 20px 0">
      <h1>
        <a href="/">
          <span>ClusterRunner</span>
          <img src="/img/box_clusterrunner_sml.png" height="80" alt="Logo">
        </a>
      </h1>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="current">
    <a href="/docs/home/">Doc<span class="show-on-mobiles">s</span><span class="hide-on-mobiles">umentation</span></a>
  </li>
  <li class="">
    <a href="/news/">Blog</a>
  </li>
  <li>
    <a href="https://github.com/box/ClusterRunner"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>

    <section class="docs">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the docs…</option>
    
    <optgroup label="Getting Started">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/home/">Welcome</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/features/">Features</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/installation/">Installation</option>
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/quickstart/">Quick Start</option>
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Tutorials">
      


  

  
    
  
    
  
    
  
    
  
    
      <option value="/docs/configuring-your-project/">Configuring Your Job</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
      <option value="/docs/ci-integration/">Integrating with CI</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Reference">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/job-configuration/">Job Configuration</option>
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/service-configuration/">Service Configuration</option>
    
  
    
  
    
  

  

  
    
      <option value="/docs/api-docs/">API Docs</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
      <option value="/docs/build-result-format/">Build Result Format</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Contribute">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/development-guide/">Development Guide</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
  </select>
</div>


      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    
    <h4>Getting Started</h4>
    

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/home/">Welcome</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/features/">Features</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/quickstart/">Quick Start</a></li>
    
  
    
  
    
  
    
  


</ul>

    
    <h4>Tutorials</h4>
    

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/configuring-your-project/">Configuring Your Job</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/ci-integration/">Integrating with CI</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


</ul>

    
    <h4>Reference</h4>
    

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/job-configuration/">Job Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/service-configuration/">Service Configuration</a></li>
    
  
    
  
    
  


  

  
    
  

  
    
      <li class=""><a href="/docs/api-docs/">API Docs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class=""><a href="/docs/build-result-format/">Build Result Format</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


</ul>

    
    <h4>Contribute</h4>
    

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/development-guide/">Development Guide</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


</ul>

    
  </aside>
</div>


      <div class="unit four-fifths">
        <article>
          <h1>Configuring Your Job</h1>
          <p>If you followed the <a href="/docs/quickstart">Quick Start</a>, you should have the ClusterRunnerDemo project checked 
out in your home directory. If you haven’t, we suggest you go back and do that first. </p>

<p>In this tutorial, we’ll walk through configuring the ‘Simple’ job you ran in the ClusterRunnerDemo 
project. In order to keep the Simple job simple, we created an example that requires no additional packages to 
be installed on your machine. </p>

<p>The Simple job will simulate running 10 tests concurrently, with each test taking 10 seconds to run and echoing 
all of the integers between 1 and 10.</p>

<h3 id="clusterrunneryaml">clusterrunner.yaml</h3>

<p>Before you start configuring your jobs, you’ll need to create a config file. ClusterRunner looks 
for a file named <a href="/docs/job-configuration">clusterrunner.yaml</a> in your root project directory.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">~ <span class="nv">$ </span><span class="nb">cd</span> ~/ClusterRunnerDemo
~ <span class="nv">$ </span>vim clusterrunner.yaml</code></pre></div>

<h3 id="job-name">Job Name</h3>

<p>Next, give your job a name. Because this is a simple job created for demonstration, we have chosen 
the name ‘Simple’. Creative, no?</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">Simple</span><span class="pi">:</span></code></pre></div>

<p>This is a root-level yaml element. The next yaml sections we’re going to add should be indented one level from here.</p>

<h3 id="setupbuild">setup_build:</h3>

<p>What setup step do we need for our simple job? Nothing really, but for demonstrative purposes, let’s output a
simple message.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">setup_build</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo 'Performing setup'</span></code></pre></div>

<p>Typically, this is where you would ensure that all necessary services are started, as well as run <em>make</em> 
if needed. </p>

<h3 id="teardownbuild">teardown_build:</h3>

<p>Similarly, we don’t have any necessary teardown steps to clean up after this build. But lets add one anyway.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">teardown_build</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo 'Performing teardown'</span></code></pre></div>

<p>In more complex jobs, you would undo any global state that was set on this machine during the build.</p>

<h3 id="atomizers">atomizers:</h3>

<p>Now we’re getting to the good stuff! Here’s where you tell ClusterRunner how to “atomize”, or break apart, your tests
into individually runnable units. </p>

<p>Your atomizer command should generate a list of parameter values that will then each be fed into the <em>commands</em> section.
For this example, we want to run ten “tests” where each test just echoes a number between 1 and 10. We do that by exporting
an environment variable, which we named <code>$TOKEN</code>, to contain each of the values 1 through 10. </p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">atomizers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">TOKEN</span><span class="pi">:</span> <span class="s">seq 1 10</span></code></pre></div>

<p>This means that the <em>commands</em> section will be executed ten times, with each execution having the <code>$TOKEN</code> environment
variable set to one of the values 1 through 10.</p>

<p>(In the command above, <code>seq</code> is <a href="http://en.wikipedia.org/wiki/Seq_(Unix)">a Unix utility</a> for generating ranges.)</p>

<h3 id="commands">commands:</h3>

<p>This is the most signficant part of the configuration where you specify how to run your test. As stated 
earlier, the Simple job will simulate a 10 second test that echoes one of the numbers between 1 and 10 to the console. </p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">commands</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">cd $PROJECT_DIR</span>
    <span class="pi">-</span> <span class="s">sleep 10</span>
    <span class="pi">-</span> <span class="s">echo $TOKEN</span></code></pre></div>

<p>Notice how we incorporated the environment variable, <code>$TOKEN</code>, from the <em>atomizers</em> section.
This is how the <em>atomizers</em> and the <em>commands</em> sections interact.</p>

<h3 id="maxexecutors">max_executors:</h3>

<p>You could set this to blank, but because we are demonstrating…</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">max_executors</span><span class="pi">:</span> <span class="s">10</span></code></pre></div>

<p>Obviously, because we are only running 10 tests, there is never going to be a need to use more than 10
executors for this particular job. </p>

<p>By default, if you don’t specify <em>max_executors</em>, ClusterRunner will allocate every executor available 
on the slaves until the job runs out of atoms to work on. It may sound desirable to never specify 
<em>max_executors</em>, but if you are running jobs that have diminishing returns as you scale horizontally,
you may want to restrict the number of executors that a single build can hog so that other builds can utilize 
those executors instead.</p>

<h2 id="the-finished-product">The finished product</h2>

<p>Putting it all together, your clusterrunner.yaml file will look like this:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">Simple</span><span class="pi">:</span>
    <span class="s">max_executors</span><span class="pi">:</span> <span class="s">10</span>

    <span class="s">setup_build</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">echo 'Performing setup'</span>

    <span class="s">teardown_build</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">echo 'Performing teardown'</span>

    <span class="s">commands</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">cd $PROJECT_DIR</span>
        <span class="pi">-</span> <span class="s">sleep 10</span>
        <span class="pi">-</span> <span class="s">echo $TOKEN</span>

    <span class="s">atomizers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">TOKEN</span><span class="pi">:</span> <span class="s">seq 1 10</span></code></pre></div>

<p>The order of the sections does not matter.</p>

<p>You should take some time to tweak the Simple job configuration and see how it affects the build artifact 
you get returned. Be adventurous!</p>

<p>Try:</p>

<ul>
  <li>writing some files to $ARTIFACT_DIR/ </li>
  <li>writing some invalid shell commands</li>
  <li>performing a random ‘exit 1’</li>
</ul>

<p>and just run: </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">~ <span class="nv">$ </span>clusterrunner build --job-name Simple</code></pre></div>

<p>to check out the new results! The ./build_results/ directory should be updated every time you execute a build.
See the <a href="/docs/build-result-format">Build Result Format</a> page for details.</p>

<h2 id="more-practical-examples">More practical examples</h2>

<p>The Simple job just spins ClusterRunner’s wheels. If you’d like to view a real test suite, inspect the 
‘PHPUnit’ and ‘Nose’ jobs in ClusterRunnerDemo’s <code>clusterrunner.yaml</code>.</p>

<p>Make sure you have <a href="https://phpunit.de/manual/current/en/installation.html">phpunit</a> and/or <a href="https://nose.readthedocs.org/en/latest/">nosetests</a> installed, and try running the respective ClusterRunner jobs! </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">~ <span class="nv">$ </span>clusterrunner build --job-name PHPUnit
~ <span class="nv">$ </span>clusterrunner build --job-name Nose</code></pre></div>


          <div class="section-nav">
  <div class="left align-right">
    
      
      
      
        

          
          

        
        
      
        

          
          

        

          
          

        

          
          

        

          
          

        
        
      
        

          
          

        

          
          
            
          

        
        
      
        

          
          
            <a href="/docs/quickstart/" class="prev">Back</a>
            
            
        

      
    
  </div>

  <div class="right align-left">
    
      
      
      
        

          
          

        

          
          

        

          
          

        

          
          

        
        
      
        

          
          
            
          

        

          
          
            <a href="/docs/ci-integration/" class="next">Next</a>
            
            
        

      
    
  </div>
  <div class="clear"></div>
</div>


        </article>
      </div>


      <div class="clear"></div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>Box Open Source</p>
    </div>
    <div class="unit two-thirds align-right center-on-mobiles">
      <p>
        Proudly hosted by
        <a href="https://github.com">
          <img src="/img/footer-logo.png" width="100" height="30" alt="GitHub • Social coding">
        </a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<i class=\"fa fa-link\"></i>";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>

  
  <!-- Gauges (http://gaug.es/) -->
  <script>
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', 'ZZZ');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>



  <!-- Google Analytics (http://google.com/analytics) -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'ZZZ', 'clusterrunner.com');
    ga('send', 'pageview');

  </script>



</body>
</html>
